<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern QR Scanner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #34a853;
            --accent-color: #fbbc05;
            --danger-color: #ea4335;
            --light-color: #f8f9fa;
            --dark-color: #202124;
            --gray-color: #5f6368;
            --border-radius: 16px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f7;
            color: var(--dark-color);
            height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .scanner-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #fff;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: var(--box-shadow);
        }
        
        .header {
            padding: 1.5rem;
            text-align: center;
            background-color: #fff;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }
        
        .subtitle {
            color: var(--gray-color);
            margin-bottom: 0;
            font-size: 0.95rem;
        }
        
        .scanner-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            padding: 1rem;
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 100%;
            overflow: hidden;
            border-radius: var(--border-radius);
            background-color: #000;
            box-shadow: var(--box-shadow);
        }
        
        #video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.3);
        }
        
        .scanner-frame {
            position: relative;
            width: 70%;
            height: 70%;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 12px;
        }
        
        .corner {
            position: absolute;
            width: 20px;
            height: 20px;
            border-color: var(--primary-color);
            border-width: 4px;
        }
        
        .top-left {
            top: -2px;
            left: -2px;
            border-top-style: solid;
            border-left-style: solid;
            border-top-left-radius: 8px;
        }
        
        .top-right {
            top: -2px;
            right: -2px;
            border-top-style: solid;
            border-right-style: solid;
            border-top-right-radius: 8px;
        }
        
        .bottom-left {
            bottom: -2px;
            left: -2px;
            border-bottom-style: solid;
            border-left-style: solid;
            border-bottom-left-radius: 8px;
        }
        
        .bottom-right {
            bottom: -2px;
            right: -2px;
            border-bottom-style: solid;
            border-right-style: solid;
            border-bottom-right-radius: 8px;
        }
        
        .scanner-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background-color: var(--primary-color);
            top: 50%;
            transform: translateY(-50%);
            animation: scan 2s linear infinite;
        }
        
        @keyframes scan {
            0% {
            top: 20%;
            opacity: 0.8;
            }
            50% {
            top: 80%;
            opacity: 1;
            }
            100% {
            top: 20%;
            opacity: 0.8;
            }
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .btn {
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover,
        .btn-primary:focus {
            background-color: #3367d6;
            border-color: #3367d6;
            box-shadow: 0 4px 8px rgba(66, 133, 244, 0.3);
        }
        
        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-outline-primary:hover,
        .btn-outline-primary:focus {
            background-color: rgba(66, 133, 244, 0.1);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status-bar {
            padding: 1rem 1.5rem;
            background-color: #fff;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--accent-color);
        }
        
        .scanning .status-dot {
            background-color: var(--primary-color);
            animation: pulse 1.5s infinite;
        }
        
        .success .status-dot {
            background-color: var(--secondary-color);
        }
        
        .error .status-dot {
            background-color: var(--danger-color);
        }
        
        @keyframes pulse {
            0% {
            transform: scale(1);
            opacity: 1;
            }
            50% {
            transform: scale(1.2);
            opacity: 0.7;
            }
            100% {
            transform: scale(1);
            opacity: 1;
            }
        }
        
        /* Modal styling */
        .modal-content {
            border-radius: 16px;
            border: none;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding: 1.25rem 1.5rem;
        }
        
        .modal-title {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .result-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .result-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 64px;
            height: 64px;
            background-color: rgba(66, 133, 244, 0.1);
            border-radius: 50%;
            color: var(--primary-color);
        }
        
        .result-text {
            flex: 1;
        }
        
        .result-text h6 {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--gray-color);
        }
        
        #resultText {
            word-break: break-all;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .modal-footer {
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            padding: 1.25rem 1.5rem;
        }
        
        /* Responsive adjustments */
        @media (max-width: 576px) {
            .scanner-container {
            height: 100vh;
            max-width: 100%;
            }
        
            .camera-container {
            padding-bottom: 100%;
            }
        
            .header {
            padding: 1rem;
            }
        
            .header h1 {
            font-size: 1.5rem;
            }
        
            .controls {
            margin-top: 1rem;
            }
        
            .btn {
            padding: 0.6rem 1.2rem;
            font-size: 0.95rem;
            }
        }
        
        @media (min-width: 768px) {
            .camera-container {
            padding-bottom: 75%;
            max-width: 500px;
            margin: 0 auto;
            }
        }
        
        
    </style>
</head>
<body>
    <div class="container-fluid p-0 scanner-container">
        <div class="header">
            <h1>QR Scanner</h1>
            <p class="subtitle">Position the QR code within the frame</p>
        </div>

        <div class="scanner-wrapper">
            <div class="camera-container">
                <video id="video" playsinline></video>
                <canvas id="canvas" class="d-none"></canvas>
                <div class="scanner-overlay">
                    <div class="scanner-frame">
                        <div class="corner top-left"></div>
                        <div class="corner top-right"></div>
                        <div class="corner bottom-left"></div>
                        <div class="corner bottom-right"></div>
                        <div class="scanner-line"></div>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button id="startButton" class="btn btn-primary">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-camera"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                    </span>
                    Scan
                </button>
                <button id="switchCameraButton" class="btn btn-outline-primary d-none">
                    <span class="icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-refresh-cw"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                    </span>
                    Switch Camera
                </button>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="statusText">Ready to scan</span>
            </div>
        </div>
    </div>

    <!-- Result Modal -->
    <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resultModalLabel">QR Code Result</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="result-container">
                        <div class="result-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
                        </div>
                        <div class="result-text">
                            <h6>Scanned URL:</h6>
                            <p id="resultText" class="mb-0"></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a id="openLinkBtn" href="#" target="_blank" class="btn btn-primary">Open Link</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
        const video = document.getElementById("video")
        const canvas = document.getElementById("canvas")
        const startButton = document.getElementById("startButton")
        const switchCameraButton = document.getElementById("switchCameraButton")
        const statusText = document.getElementById("statusText")
        const statusBar = document.querySelector(".status-bar")
        const resultText = document.getElementById("resultText")
        const openLinkBtn = document.getElementById("openLinkBtn")
    
        let scanning = false
        let currentStream = null
        const canvasContext = canvas.getContext("2d")
        let currentFacingMode = "environment" // Start with back camera
    
        // Modal instance
        const resultModal = new bootstrap.Modal(document.getElementById("resultModal"))
    
        // Check if the browser supports getUserMedia
        function hasGetUserMedia() {
        return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)
        }
    
        // Start the QR scanner
        startButton.addEventListener("click", () => {
        if (scanning) {
            stopScanner()
        } else {
            startScanner()
        }
        })
    
        // Switch between front and back cameras
        switchCameraButton.addEventListener("click", () => {
        if (currentStream) {
            stopMediaTracks(currentStream)
            currentFacingMode = currentFacingMode === "environment" ? "user" : "environment"
            startScanner()
        }
        })
    
        function startScanner() {
        if (!hasGetUserMedia()) {
            updateStatus("error", "Your browser does not support camera access")
            return
        }
    
        updateStatus("scanning", "Accessing camera...")
    
        const constraints = {
            video: {
            facingMode: currentFacingMode,
            width: { ideal: 1280 },
            height: { ideal: 720 },
            },
        }
    
        navigator.mediaDevices
            .getUserMedia(constraints)
            .then((stream) => {
            currentStream = stream
            video.srcObject = stream
            video.setAttribute("playsinline", true) // Required for iOS
    
            return video.play()
            })
            .then(() => {
            scanning = true
            startButton.textContent = "Stop Scanner"
            startButton.classList.remove("btn-primary")
            startButton.classList.add("btn-danger")
    
            // Show switch camera button if multiple cameras are available
            navigator.mediaDevices.enumerateDevices().then((devices) => {
                const videoDevices = devices.filter((device) => device.kind === "videoinput")
                if (videoDevices.length > 1) {
                switchCameraButton.classList.remove("d-none")
                }
            })
    
            updateStatus("scanning", "Scanning for QR code...")
    
            // Start scanning for QR codes
            requestAnimationFrame(tick)
            })
            .catch((error) => {
            console.error("Error accessing the camera:", error)
            updateStatus("error", "Could not access the camera")
            })
        }
    
        function stopScanner() {
        if (currentStream) {
            stopMediaTracks(currentStream)
            currentStream = null
        }
    
        scanning = false
        startButton.textContent = "Scan"
        startButton.classList.remove("btn-danger")
        startButton.classList.add("btn-primary")
        switchCameraButton.classList.add("d-none")
    
        updateStatus("", "Ready to scan")
        }
    
        function stopMediaTracks(stream) {
        stream.getTracks().forEach((track) => {
            track.stop()
        })
        video.srcObject = null
        }
    
        function tick() {
        if (!scanning) return
    
        if (video.readyState === video.HAVE_ENOUGH_DATA) {
            // Draw the video frame to the canvas
            canvas.height = video.videoHeight
            canvas.width = video.videoWidth
            canvasContext.drawImage(video, 0, 0, canvas.width, canvas.height)
    
            // Get the image data from the canvas
            const imageData = canvasContext.getImageData(0, 0, canvas.width, canvas.height)
    
            // Scan for QR code
            const code = jsQR(imageData.data, imageData.width, imageData.height, {
            inversionAttempts: "dontInvert",
            })
    
            if (code) {
            // QR code found
            console.log("QR Code detected:", code.data)
    
            // Play success sound or vibration
            if (navigator.vibrate) {
                navigator.vibrate(200)
            }
    
            // Update status
            updateStatus("success", "QR code found!")
    
            // Show the result in the modal
            showResult(code.data)
    
            // Pause scanning
            scanning = false
            startButton.textContent = "Scan"
            startButton.classList.remove("btn-danger")
            startButton.classList.add("btn-primary")
            }
        }
    
        // Continue scanning
        if (scanning) {
            requestAnimationFrame(tick)
        }
        }
    

        
        function showResult(ticketId) {
            // Update status
            updateStatus("scanning", "Validating ticket...")

            // Call the validation function with the ticket ID
            validateTicket(ticketId)
        }

        // Add this new function to validate tickets
        function validateTicket(ticketId) {
            // This would be your actual API call
            // For demo purposes, we're using a mock API with setTimeout
            setTimeout(() => {
            // Mock API response (replace with actual API call)
            const mockApiResponse = {
                isValid: Math.random() > 0.3, // 70% chance of being valid for demo
                customerName: "John Doe", // This would come from your API
            }

            if (mockApiResponse.isValid) {
                showSuccessScreen(mockApiResponse.customerName)
            } else {
                showErrorScreen()
            }
            }, 1500) // Simulate API delay
        }

        // Add this function to show the success screen
        function showSuccessScreen(customerName) {
            // Create success overlay
            const successOverlay = document.createElement("div")
            successOverlay.className = "success-overlay"

            // Create success content
            successOverlay.innerHTML = `
                <div class="success-content">
                    <div class="success-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </div>
                    <div class="success-message">
                        <h2>Ticket Valid</h2>
                        <p class="customer-name">${customerName}</p>
                    </div>
                </div>
            `

            // Add to body
            document.body.appendChild(successOverlay)

            // Add animation class after a small delay (for animation to work)
            setTimeout(() => {
            successOverlay.classList.add("show")
            }, 10)

            // Update status
            updateStatus("success", "Ticket validated successfully")

            // Remove the overlay after 4 seconds
            setTimeout(() => {
            successOverlay.classList.remove("show")
            setTimeout(() => {
                document.body.removeChild(successOverlay)
                // Reset scanner
                if (!scanning) {
                startButton.textContent = "Start Scanner"
                startButton.classList.remove("btn-danger")
                startButton.classList.add("btn-primary")
                updateStatus("", "Ready to scan")
                }
            }, 500)
            }, 4000)
        }

        // Add this function to show the error screen
        function showErrorScreen() {
            // Create error overlay
            const errorOverlay = document.createElement("div")
            errorOverlay.className = "error-overlay"

            // Create error content
            errorOverlay.innerHTML = `
                <div class="error-content">
                    <div class="error-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </div>
                    <div class="error-message">
                        <h2>Invalid Ticket</h2>
                        <p>This ticket cannot be accepted</p>
                    </div>
                </div>
            `

            // Add to body
            document.body.appendChild(errorOverlay)

            // Add animation class after a small delay (for animation to work)
            setTimeout(() => {
            errorOverlay.classList.add("show")
            }, 10)

            // Update status
            updateStatus("error", "Invalid ticket")

            // Remove the overlay after 4 seconds
            setTimeout(() => {
            errorOverlay.classList.remove("show")
            setTimeout(() => {
                document.body.removeChild(errorOverlay)
                // Reset scanner
                if (!scanning) {
                startButton.textContent = "Start Scanner"
                startButton.classList.remove("btn-danger")
                startButton.classList.add("btn-primary")
                updateStatus("", "Ready to scan")
                }
            }, 500)
            }, 4000)
        }

        function updateStatus(state, message) {
            statusText.textContent = message

            // Remove all state classes
            statusBar.classList.remove("scanning", "success", "error")

            // Add the current state class
            if (state) {
            statusBar.classList.add(state)
            }
        }
        
    })
    
    
    </script>
</body>
</html>

