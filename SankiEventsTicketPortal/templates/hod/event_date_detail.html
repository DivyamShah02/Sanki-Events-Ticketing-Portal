<!DOCTYPE html>
<html lang="en">
<!-- [Head] start -->

<head>
  <title>Sanki Events</title>
  <!-- [Meta] -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <!-- [Google Font] Family -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Big+Shoulders+Stencil:opsz,wght@10..72,100..900&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap"
    id="main-font-link" />

  <!-- [Tabler Icons] https://tablericons.com -->
  <link rel="stylesheet" href="/static/assets/fonts/tabler-icons.min.css" />
  <!-- [Feather Icons] https://feathericons.com -->
  <link rel="stylesheet" href="/static/assets/fonts/feather.css" />
  <!-- [Font Awesome Icons] https://fontawesome.com/icons -->
  <link rel="stylesheet" href="/static/assets/fonts/fontawesome.css" />
  <!-- [Material Icons] https://fonts.google.com/icons -->
  <link rel="stylesheet" href="/static/assets/fonts/material.css" />
  <!-- [Template CSS Files] -->
  <link rel="stylesheet" href="/static/assets/css/style.css" id="main-style-link" />
  <link rel="stylesheet" href="/static/assets/css/style-preset.css" />

  <!-- Include Bootstrap, jQuery, and Date Range Picker CSS & JS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
</head>
<!-- [Head] end -->
<style>
  /* Custom styles for tabs to match the image */
  .nav-tabs {
    border-bottom: 1px solid #dee2e6;
    width: 100%;
    display: flex;
  }

  .nav-tabs .nav-item {
    flex: 1;
  }

  .nav-tabs .nav-link {
    border: none;
    color: #6c757d;
    font-size: 18px;
    padding: 10px 20px;
    width: 100%;
    text-align: center;
    margin-right: 30px;
    background-color: transparent;
    transition: color 0.3s ease;
  }

  .nav-tabs .nav-link:hover {
    color: #000;
    border: none;
  }

  .nav-tabs .nav-link.active {
    color: #000;
    font-weight: 500;
    border: none;
    border-bottom: 2px solid #000;
    background-color: transparent;
  }

  /* Remove focus outline for cleaner look */
  .nav-link:focus {
    outline: none;
    box-shadow: none;
  }

  /* Add spacing between tabs and content */
  .tab-content {
    padding-top: 20px;
  }
</style>
<!-- [Body] Start -->

<body>
  <!-- [ Pre-loader ] start -->
  <div class="loader-bg">
    <div class="loader-track">
      <div class="loader-fill"></div>
    </div>
  </div>
  <!-- [ Pre-loader ] End -->

  <!-- [ Sidebar Menu ] start -->
  {% include 'hod/nav_bar.html' %}
  <!-- [ Sidebar Menu ] end -->

  <!-- Create Event Modal -->
  {% include 'hod/create_event_modal.html' %}

  <!-- Create Reseller Modal -->
  {% include 'hod/create_reseller_modal.html' %}

  <!-- [ Header Topbar ] start -->
  {% include 'header.html' %}
  <!-- [ Header ] end -->

  <!-- [ Main Content ] start -->
  <div class="pc-container">
    <div class="pc-content">
      <!-- [ Main Content ] start -->

      <div class="d-flex w-100 align-items-center">
        <!-- <div class="flex-shrink-0">
          <div
            class="avatar avatar-sm rounded-circle text-success bg-light-success d-flex align-items-center justify-content-center"
            style="width: 40px; height: 40px;">
            <i class="ti ti-calendar f-18"></i>
          </div>
        </div> -->
        <div class="flex-grow-1">
          <h2 class="mb-1" id="event-details-modal-event_name">Loading...</h2>

          <div class="col-md-6 d-flex align-items-center mb-3">
            <i class="ti ti-map-pin me-1"></i>
            <p class="text-muted text-lg mb-0" id="event-details-modal-event_venue">
              Loading...
            </p>
          </div>
        </div>
        <div class="dropdown">
          <a class="avtar avtar-s btn-link-secondary dropdown-toggle arrow-none" href="#" data-bs-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            <i class="ti ti-dots-vertical f-18"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-end">
            <a class="dropdown-item" href="#">Share</a>
            <a class="dropdown-item" href="#">Edit</a>
            <a class="dropdown-item" href="#">Delete</a>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-8">
          <div class="card">
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 d-flex align-items-center mb-3">
                  <i class="ti ti-calendar me-2"></i>
                  <p class="mb-0" id="event-details-modal-event_date_range">
                    Loading...
                  </p>
                </div>

                <div class="col-md-6 d-flex align-items-center mb-3">
                  <i class="ti ti-map-pin me-2"></i>
                  <p class="mb-0" id="event-details-modal-event_city">
                    Loading...
                  </p>
                </div>

                <div class="col-md-6 d-flex align-items-center mb-3">
                  <i class="ti ti-ticket me-2"></i>
                  <p class="mb-0">
                    Tickets Available:
                    <span id="event-details-modal-event_available_tickets">Loading...</span>
                  </p>
                </div>

                <div class="col-md-6 d-flex align-items-center mb-3">
                  <i class="ti ti-x me-2" id="event-details-modal-event_digital_pass"></i>
                  <p class="mb-0">Digital Pass</p>
                </div>

                <div class="col-md-6 d-flex align-items-center mb-3">
                  <i class="ti ti-clock me-2"></i>
                  <p class="mb-0">
                    Event Days:
                    <span id="event-details-modal-event_days">Loading...</span>
                  </p>
                </div>
              </div>
              <li class="list-group-item px-0 pb-0">
                <p class="mb-1 text-muted">Address</p>
                <h6 class="mb-0" id="event-details-modal-event_address">
                  Loading...
                </h6>
              </li>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="card">
            <div class="card-header">
              <h5>Commercial Details</h5>
            </div>
            <div class="card-body">
              <p class="mb-1 text-muted">Tickets Sold</p>
              <h6 class="mb-4" id="event-details-modal-event_ticket_sold">
                Loading...
              </h6>
              <p class="mb-1 text-muted">Total Sales</p>
              <h6 class="mb-4" id="event-details-modal-event_total_sales">
                Loading...
              </h6>
            </div>
          </div>
        </div>
      </div>

      <div class="container mt-4 flex">
        <!-- Tabs Navigation -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="resellers-tab" data-bs-toggle="tab" data-bs-target="#resellers-section"
              type="button" role="tab" aria-controls="resellers-section" aria-selected="true">
              All Resellers
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tickets-tab" data-bs-toggle="tab" data-bs-target="#tickets-section"
              type="button" role="tab" aria-controls="tickets-section" aria-selected="false">
              All Tickets
            </button>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="myTabContent">
          <!-- Resellers Section -->
          <div class="tab-pane fade show active" id="resellers-section" role="tabpanel" aria-labelledby="resellers-tab">
            <div class="col-md-12 col-xl-12">
              <!-- <h5 class="mb-3">All Resellers</h5> -->
              <div class="card tbl-card">
                <div class="card-body pt-0">
                  <div class="table-responsive">
                    <table class="table table-hover table-borderless mb-0">
                      <thead>
                        <tr>
                          <th>NAME</th>
                          <th class="text-center text-nowrap">EMAIL</th>
                          <th class="text-center text-nowrap">TICKETS SOLD</th>
                          <th class="text-center text-nowrap">AVAILABLE</th>
                          <th class="text-center text-nowrap">ACTION</th>
                        </tr>
                      </thead>
                      <tbody id="resellers-list">
                        <!-- Dynamic ticket sales data will be populated here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Resellers List -->
            <div class="col-md-12 col-xl-12">
              <!-- <h5 class="mb-3">All Resellers</h5> -->
              <div class="card" style="max-height: 495px">
                <div class="list-group list-group-flush overflow-y-scroll" id="resellers-list"></div>
              </div>
            </div>
          </div>
          <!-- Tickets Section -->
          <div class="tab-pane fade" id="tickets-section" role="tabpanel" aria-labelledby="tickets-tab">
            <div class="col-md-12 col-xl-12">
              <!-- <h5 class="mb-3">Ticket Status</h5> -->
              <div class="card tbl-card">
                <div class="card-body mt-0">
                  <div class="table-responsive">
                    <table class="table table-hover table-borderless mb-0">
                      <thead>
                        <tr>
                          <th>CUSTOMER NAME</th>
                          <th>EVENT NAME</th>
                          <th>QUANTITY</th>
                          <th>STATUS</th>
                          <th class="text-end">TOTAL AMOUNT</th>
                        </tr>
                      </thead>
                      <tbody id="ticket-sales-table-body">
                        <!-- Dynamic ticket sales data will be populated here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Assign Tickets Modal -->
      <div class="modal fade " id="AssignticketsModal" tabindex="-1" aria-labelledby="AssignticketsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="AssignticketsModalLabel">
                Assign Tickets
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <div class="row">
                <div class="col-md-6 d-flex align-items-center mb-3">

                  <p class="mb-0" id="assign-tickets-modal-reseller_name">
                    Reseller Name :- Loading..
                  </p>
                </div>

                <div class="col-md-6 d-flex align-items-center mb-3">

                  <p class="mb-0" id="assign-tickets-modal-reseller_email">
                    Reseller Email :- Loading..
                  </p>
                </div>

                <div class="col-md-6 d-flex align-items-center mb-3">

                  <p class="mb-0" id="assign-tickets-modal-event_name">
                    Event Name :- Loading...
                  </p>
                </div>

                <div class="col-md-6 d-flex align-items-center mb-3">
                  <p class="mb-0" id="assign-tickets-modal-event_date">
                    Event Date :- Loading.. </p>
                </div>
                <div class="col-md-6 d-flex align-items-center mb-3">
                  <p class="mb-0" id="assign-tickets-modal-assigned_tickets">
                    Assigned Tickets :- Loading.. </p>
                </div>
                <div class="col-md-6 d-flex align-items-center mb-3">
                  <p class="mb-0" id="assign-tickets-modal-available_tickets">
                    Available Tickets :- Loading.. </p>
                </div>

                <h5 for="assigntickets" class="form-label mt-3">Assign more tickets</h5>
                <div class="col-md-12 d-flex align-items-center mb-1">

                  <input type="text" class="form-control" id="assigntickets" placeholder="Assign more tickets"/>
                </div>

              </div>
              <!-- Form with 5 fields, only 1 being input -->

              <form>

                <div class="modal-footer p-0">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    Close
                  </button>
                  <button type="submit" class="btn btn-primary">
                    Assign Tickets
                  </button>
                </div>
              </form>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- [ Main Content ] end -->

  {% include 'footer.html' %}

  <!-- [Page Specific JS] start -->
  <!-- <script src="/static/assets/js/plugins/apexcharts.min.js"></script> -->
  <!-- <script src="/static/assets/js/pages/dashboard-default.js"></script> -->
  <!-- [Page Specific JS] end -->

  <!-- Required Js -->
  <script src="/static/assets/js/plugins/popper.min.js"></script>
  <script src="/static/assets/js/plugins/simplebar.min.js"></script>
  <script src="/static/assets/js/plugins/bootstrap.min.js"></script>
  <script src="/static/assets/js/fonts/custom-font.js"></script>
  <script src="/static/assets/js/pcoded.js"></script>
  <script src="/static/assets/js/plugins/feather.min.js"></script>
  <script src="/static/assets/js/api_caller.js"></script>
  <script src="/static/assets/js/script.js"></script>

  <!--scripts for dynamic data-->
  <script>
    let data = {};
    const event_date_id = new URLSearchParams(window.location.search).get(
      "event_date_id"
    );
    window.onload = async function () {
      fetchHodEventsData();
    };

    async function fetchHodEventsData() {
      try {
        const Params = {
          event_date_id: event_date_id,
        };

        const url =
          "{% url 'hod-event-date-data-api-list' %}?" + toQueryString(Params); // Construct the full URL with query params
        const [success, result] = await callApi("GET", url);
        if (success) {
          if (result.success) {
            data = result.data; // Extract actual data object
            console.log(data);
            let event_data = data.event_data;
            let event_date_data = data.event_date_data;
            let date_html = "";
            event_data.all_dates.forEach((date) => {
              date_html += `<span class="badge bg-light-secondary border border-secondary bg-transparent f-14 me-1 mt-1">${date}</span>`;
            });

            //populate reseller list 
            const resellerTable = document.getElementById(
              "resellers-list"
            );
            resellerTable.innerHTML = "";
            data.reseller_data.forEach((reseller) => {
              const ticketRow = `
              <tr>
                  <td class="text-nowrap"><b>${reseller.name}</b></td>
                  <td class="text-center">${reseller.email}</td>
                  <td class="text-center">${reseller.total_tickets_sold_seller} ( ₹${reseller.total_tickets_sold_seller_amount.toLocaleString("en-IN")} )</td>
                  <td class="text-center">${reseller.available_tickets}</td>
                  <td class="text-center">
                    <button type="button" class="btn btn-primary text-nowrap"
                    onclick="handleAssignTicketsModal('${reseller.name}', '${reseller.email}', '${event_data.event_name}', '${event_date_data.date}', '${reseller.assigned_tickets}', '${reseller.available_tickets}')"
                    >Assign Tickets</button>
                  </td>
              </tr>`;
              resellerTable.innerHTML += ticketRow;
            });

            // Populate ticket sales table dynamically
            const ticketTableBody = document.getElementById(
              "ticket-sales-table-body"
            );
            ticketTableBody.innerHTML = "";
            event_data.all_tickets.forEach((ticket) => {
              let statusClass =
                ticket.status.toLowerCase() === "approved"
                  ? "text-success"
                  : "text-danger";
              if (ticket.status.toLowerCase() === "mail sent") {
                statusClass = "text-primary";
              }
              const ticketRow = `
              <tr>
                  <td><a href="#" class="text-muted">${ticket.customer_name
                }</a></td>
                  <td>${ticket.event_name}</td>
                  <td>${ticket.qty}</td>
                  <td>
                       <span class="d-flex align-items-center gap-2">
                                <i class="fas fa-circle ${statusClass} f-10 m-r-5"></i> ${ticket.status
                }
                        </span>
                  </td>
                  <td class="text-end">₹${ticket.amount.toLocaleString("en-IN")}</td>
              </tr>`;
              ticketTableBody.innerHTML += ticketRow;
            });

            document.getElementById(
              "event-details-modal-event_name"
            ).innerText = event_data.event_name;
            document.getElementById(
              "event-details-modal-event_venue"
            ).innerText = `${event_data.event_venue}, ${formatDate(event_date_data.date)}`;
            // document.getElementById('event-details-modal-event_details').innerText = '';
            document.getElementById(
              "event-details-modal-event_date_range"
            ).innerText = event_data.event_date_range;
            document.getElementById(
              "event-details-modal-event_city"
            ).innerText = `${event_data.city}, ${event_data.state}`;
            document.getElementById(
              "event-details-modal-event_available_tickets"
            ).innerText = event_data.number_of_tickets;
            document.getElementById(
              "event-details-modal-event_digital_pass"
            ).className =
              event_data.digital_pass === true
                ? "ti ti-check me-2"
                : "ti ti-x me-2";
            document.getElementById(
              "event-details-modal-event_address"
            ).innerText = event_data.event_address;
            document.getElementById(
              "event-details-modal-event_ticket_sold"
            ).innerText = event_data.total_event_ticket_sold;
            document.getElementById(
              "event-details-modal-event_total_sales"
            ).innerText = `₹${event_data.total_event_ticket_sold_amount.toLocaleString(
              "en-IN"
            )}`;
            document.getElementById(
              "event-details-modal-event_days"
            ).innerHTML = date_html;

          }
        } else {
        }
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }
  
    function handleAssignTicketsModal(reseller_name, reseller_email, event_name, event_date, assigned_tickets, available_tickets) {
      console.log('earbguobfwobrgtuhb');
      document.getElementById('assign-tickets-modal-reseller_name').innerText = `Reseller Name :  ${reseller_name}`;
      document.getElementById('assign-tickets-modal-reseller_email').innerText = `Reseller Email :  ${reseller_email}`;
      document.getElementById('assign-tickets-modal-event_name').innerText = `Event Name :  ${event_name}`;
      document.getElementById('assign-tickets-modal-event_date').innerText = `Event Date :  ${formatDate(event_date)}`;
      document.getElementById('assign-tickets-modal-assigned_tickets').innerText = `Assigned Tickets :  ${assigned_tickets}`;
      document.getElementById('assign-tickets-modal-available_tickets').innerText = `Available Tickets :  ${available_tickets}`;
      const assignTicketsModal = new bootstrap.Modal(
        document.getElementById("AssignticketsModal")
      );
      assignTicketsModal.show();
    }
  </script>

</body>
<!-- [Body] end -->

</html>